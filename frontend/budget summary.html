<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Budget Summary - GlobeTrotter</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200..800&amp;family=Noto+Sans:wght@400;500;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0d7ff2",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"],
                        "body": ["Noto Sans", "sans-serif"],
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }

        .symbol-filled {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen flex flex-col overflow-x-hidden">
    <header
        class="sticky top-0 z-50 w-full border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-[#101922]/90 backdrop-blur-md">
        <div class="px-4 md:px-10 py-3 flex items-center justify-end mx-auto max-w-[1200px]">
            <div class="hidden md:flex items-center gap-6 mr-8">
                <nav class="flex items-center gap-6">
                    <a class="text-sm font-medium hover:text-primary transition-colors text-slate-600 dark:text-slate-300"
                        href="dashboard.html">Dashboard</a>
                    <a class="text-sm font-medium hover:text-primary transition-colors text-slate-600 dark:text-slate-300"
                        href="dashboard.html">My Trips</a>
                    <a class="text-sm font-bold text-primary hover:text-primary transition-colors"
                        href="budget%20summary.html">Budget</a>
                    <a class="text-sm font-medium hover:text-primary transition-colors text-slate-600 dark:text-slate-300"
                        href="itinerary.html">Itinerary</a>
                </nav>
            </div>
            <div class="flex items-center gap-4">
                <button
                    class="relative text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors">
                    <span class="material-symbols-outlined text-2xl symbol-filled">notifications</span>
                    <span
                        class="absolute top-0 right-0 size-2 bg-red-500 rounded-full border border-white dark:border-[#101922]"></span>
                </button>
                <div class="size-10 rounded-full bg-slate-200 dark:bg-slate-700 overflow-hidden border border-slate-300 dark:border-slate-600 cursor-pointer bg-cover bg-center"
                    data-alt="User profile avatar placeholder"
                    style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAIhKwclRTjW-BWNehw--KJVrAOOrFe5XFx0EJtOG9MdzNSHGriqIRhG6xyOcYRKauTJKS5QqFef-lAiWljcCBbm4LVJCyQe-ZqwtGqeoHwOpWXWpeX2LUqdfcKS_eYeSVD-5DCn3nW0lNxL2l8v5GrNjzUJyyLqyBrMO14bqYpIIoMk7d9qYzkEjLzdFeJBv2Y_Ff8ecPqNKcaHWtMmyhajKt_HE3VPpTU6uMjvOoxGK1GrvRJKJb_ZsvL56JS_ZwfhPLl57zAmz0");'>
                </div>
            </div>
        </div>
    </header>
    <main class="flex-grow w-full max-w-[960px] mx-auto px-4 md:px-10 py-8">
        <div class="flex flex-wrap items-center gap-2 mb-8 text-sm">
            <a class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary font-medium"
                href="#">Home</a>
            <span class="text-slate-400 dark:text-slate-600">/</span>
            <a class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary font-medium"
                href="#">My Trips</a>
            <span class="text-slate-400 dark:text-slate-600">/</span>
            <a class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary font-medium"
                href="#">Europe 2024</a>
            <span class="text-slate-400 dark:text-slate-600">/</span>
            <span class="text-slate-900 dark:text-white font-semibold">Budget</span>
        </div>
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-black tracking-tight text-slate-900 dark:text-white mb-2">Budget
                    Summary</h1>
                <p class="text-slate-500 dark:text-slate-400 text-base md:text-lg">Review the estimated financial
                    breakdown for your upcoming adventure.</p>
            </div>
            <div class="flex items-center gap-3">
                <button
                    class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-semibold hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                    <span class="material-symbols-outlined text-lg">currency_exchange</span>
                    <span>INR (‚Çπ)</span>
                </button>
                <button
                    class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-semibold hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                    <span class="material-symbols-outlined text-lg">share</span>
                    Share
                </button>
            </div>
        </div>
        <div
            class="bg-white dark:bg-slate-800 rounded-xl p-8 border border-slate-200 dark:border-slate-700 shadow-sm mb-6 relative overflow-hidden group">
            <div
                class="absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none">
            </div>
            <div class="relative z-10 flex flex-col md:flex-row md:items-end justify-between gap-6">
                <div class="flex flex-col gap-2">
                    <h2 class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400">Total
                        Estimated Cost</h2>
                    <div class="flex items-baseline gap-2">
                        <span
                            class="text-5xl md:text-6xl font-black text-slate-900 dark:text-white tracking-tighter">‚Çπ6,700</span>
                        <span class="text-slate-400 dark:text-slate-500 font-medium text-lg">total</span>
                    </div>
                </div>
                <div
                    class="flex items-center gap-2 bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-200 px-4 py-2 rounded-lg border border-amber-100 dark:border-amber-800/30">
                    <span class="material-symbols-outlined text-lg">smart_toy</span>
                    <span class="text-xs md:text-sm font-medium">Prices are approximate and AI-estimated</span>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-slate-100 dark:border-slate-700">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Spend Distribution</span>
                </div>
                <div class="flex h-3 w-full rounded-full overflow-hidden bg-slate-100 dark:bg-slate-700">
                    <div class="bg-primary" style="width: 37%"></div>
                    <div class="bg-indigo-400" style="width: 45%"></div>
                    <div class="bg-teal-400" style="width: 18%"></div>
                </div>
                <div class="flex flex-wrap gap-4 mt-3">
                    <div class="flex items-center gap-2">
                        <div class="size-2 rounded-full bg-primary"></div>
                        <span class="text-xs font-medium text-slate-500 dark:text-slate-400">Travel (37%)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="size-2 rounded-full bg-indigo-400"></div>
                        <span class="text-xs font-medium text-slate-500 dark:text-slate-400">Stay (45%)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="size-2 rounded-full bg-teal-400"></div>
                        <span class="text-xs font-medium text-slate-500 dark:text-slate-400">Activities (18%)</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div
                class="flex flex-col gap-4 p-5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                        <span class="material-symbols-outlined text-2xl">train</span>
                    </div>
                    <button class="text-slate-400 hover:text-primary transition-colors">
                        <span class="material-symbols-outlined text-xl">edit</span>
                    </button>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white">Travel</h3>
                    <p class="text-slate-500 dark:text-slate-400 text-sm">Flights, trains &amp; local transit</p>
                </div>
                <div
                    class="mt-auto pt-4 border-t border-slate-100 dark:border-slate-700 flex items-end justify-between">
                    <span class="text-2xl font-bold text-slate-900 dark:text-white">‚Çπ2,500</span>
                    <span
                        class="text-xs font-medium px-2 py-1 rounded bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300">3
                        legs</span>
                </div>
            </div>
            <div
                class="flex flex-col gap-4 p-5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="size-12 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-500">
                        <span class="material-symbols-outlined text-2xl">hotel</span>
                    </div>
                    <button class="text-slate-400 hover:text-primary transition-colors">
                        <span class="material-symbols-outlined text-xl">edit</span>
                    </button>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white">Stay</h3>
                    <p class="text-slate-500 dark:text-slate-400 text-sm">Hotels, hostels &amp; rentals</p>
                </div>
                <div
                    class="mt-auto pt-4 border-t border-slate-100 dark:border-slate-700 flex items-end justify-between">
                    <span class="text-2xl font-bold text-slate-900 dark:text-white">‚Çπ3,000</span>
                    <span
                        class="text-xs font-medium px-2 py-1 rounded bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300">5
                        nights</span>
                </div>
            </div>
            <div
                class="flex flex-col gap-4 p-5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="size-12 rounded-lg bg-teal-500/10 flex items-center justify-center text-teal-500">
                        <span class="material-symbols-outlined text-2xl">local_activity</span>
                    </div>
                    <button class="text-slate-400 hover:text-primary transition-colors">
                        <span class="material-symbols-outlined text-xl">edit</span>
                    </button>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white">Activities</h3>
                    <p class="text-slate-500 dark:text-slate-400 text-sm">Tours, museums &amp; events</p>
                </div>
                <div
                    class="mt-auto pt-4 border-t border-slate-100 dark:border-slate-700 flex items-end justify-between">
                    <span class="text-2xl font-bold text-slate-900 dark:text-white">‚Çπ1,200</span>
                    <span
                        class="text-xs font-medium px-2 py-1 rounded bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300">8
                        planned</span>
                </div>
            </div>
        </div>
        <div
            class="mt-6 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl p-6 flex flex-col items-center justify-center text-center hover:border-primary/50 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all cursor-pointer group">
            <div
                class="size-10 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                <span class="material-symbols-outlined text-slate-400 dark:text-slate-500">add</span>
            </div>
            <p class="text-slate-900 dark:text-white font-medium">Add another expense category</p>
            <p class="text-slate-500 dark:text-slate-400 text-sm">Include food, shopping, or visa fees</p>
        </div>
    </main>
    <script>
        // ============= API HELPER =============
        const API_BASE = 'http://localhost:5000/api';

        async function apiRequest(endpoint) {
            const res = await fetch(API_BASE + endpoint);
            return res.json();
        }

        function showToast(message, type) {
            document.querySelectorAll('.toast').forEach(t => t.remove());
            const colors = { success: '#22c55e', error: '#ef4444', warning: '#f59e0b', info: '#3b82f6' };
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.cssText = `position:fixed;bottom:20px;right:20px;background:${colors[type] || colors.info};color:white;padding:12px 24px;border-radius:8px;z-index:9999;font-weight:600;`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatCurrency(amount) {
            return '‚Çπ' + amount.toLocaleString('en-IN');
        }

        // ============= BUDGET CALCULATION =============
        function calculateBudget(stops) {
            const costs = {
                flight: { travel: 5000, perDay: 2500 },
                train: { travel: 800, perDay: 1500 },
                bus: { travel: 400, perDay: 1200 }
            };

            let travelCost = 0;
            let stayCost = 0;
            let activitiesCost = 0;
            let totalLegs = 0;
            let totalNights = 0;

            stops.forEach(stop => {
                const mode = stop.mode || 'train';
                const days = stop.stay_days || 1;
                const modeCosts = costs[mode] || costs.train;

                travelCost += modeCosts.travel;
                stayCost += modeCosts.perDay * days;
                activitiesCost += 200 * days; // ‚Çπ200/day for activities
                totalLegs++;
                totalNights += days;
            });

            return {
                travel: travelCost,
                stay: stayCost,
                activities: activitiesCost,
                total: travelCost + stayCost + activitiesCost,
                legs: totalLegs,
                nights: totalNights
            };
        }

        // ============= LOAD AND DISPLAY BUDGET =============
        async function loadBudget() {
            const tripId = localStorage.getItem('currentTripId');

            if (!tripId) {
                showToast('No trip selected', 'warning');
                displayDefaultBudget();
                return;
            }

            try {
                showToast('Loading budget...', 'info');
                const trip = await apiRequest('/trip/' + tripId);
                console.log('Trip for budget:', trip);

                if (!trip || !trip.id) {
                    displayDefaultBudget();
                    return;
                }

                displayBudget(trip);
                showToast('Budget calculated!', 'success');

            } catch (err) {
                console.error(err);
                displayDefaultBudget();
            }
        }

        function displayBudget(trip) {
            const stops = trip.stops || [];
            const budget = calculateBudget(stops);

            // Update trip name in breadcrumb
            const breadcrumbs = document.querySelectorAll('nav a');
            if (breadcrumbs[2]) {
                breadcrumbs[2].textContent = trip.name;
            }

            // Update total cost
            const totalEl = document.querySelector('.text-5xl, .text-6xl');
            if (totalEl) {
                totalEl.textContent = formatCurrency(budget.total);
            }

            // Update category cards
            const categoryCards = document.querySelectorAll('.flex.flex-col.gap-4.p-5');

            // Travel card
            if (categoryCards[0]) {
                const amountEl = categoryCards[0].querySelector('.text-2xl.font-bold');
                const legsEl = categoryCards[0].querySelector('.text-xs.font-medium.px-2');
                if (amountEl) amountEl.textContent = formatCurrency(budget.travel);
                if (legsEl) legsEl.textContent = budget.legs + ' legs';
            }

            // Stay card
            if (categoryCards[1]) {
                const amountEl = categoryCards[1].querySelector('.text-2xl.font-bold');
                const nightsEl = categoryCards[1].querySelector('.text-xs.font-medium.px-2');
                if (amountEl) amountEl.textContent = formatCurrency(budget.stay);
                if (nightsEl) nightsEl.textContent = budget.nights + ' nights';
            }

            // Activities card
            if (categoryCards[2]) {
                const amountEl = categoryCards[2].querySelector('.text-2xl.font-bold');
                const plannedEl = categoryCards[2].querySelector('.text-xs.font-medium.px-2');
                if (amountEl) amountEl.textContent = formatCurrency(budget.activities);
                if (plannedEl) plannedEl.textContent = stops.length + ' planned';
            }

            // Update percentage bar
            const travelPct = Math.round((budget.travel / budget.total) * 100);
            const stayPct = Math.round((budget.stay / budget.total) * 100);
            const actPct = 100 - travelPct - stayPct;

            const bars = document.querySelectorAll('.flex.h-3.w-full > div');
            if (bars[0]) bars[0].style.width = travelPct + '%';
            if (bars[1]) bars[1].style.width = stayPct + '%';
            if (bars[2]) bars[2].style.width = actPct + '%';

            // Update legend
            const legendItems = document.querySelectorAll('.flex.items-center.gap-2 .text-xs');
            if (legendItems[0]) legendItems[0].textContent = `Travel (${travelPct}%)`;
            if (legendItems[1]) legendItems[1].textContent = `Stay (${stayPct}%)`;
            if (legendItems[2]) legendItems[2].textContent = `Activities (${actPct}%)`;
        }

        function displayDefaultBudget() {
            // Show default values when no trip selected
            const totalEl = document.querySelector('.text-5xl, .text-6xl');
            if (totalEl) totalEl.textContent = formatCurrency(6700);
        }

        // ============= INITIALIZE =============
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üåç GlobeTrotter Budget Page Loaded');
            loadBudget();
        });
    </script>
</body>

</html>